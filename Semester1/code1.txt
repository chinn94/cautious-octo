#include <Wire.h> 
#include <LiquidCrystal_I2C.h>

LiquidCrystal_I2C lcd(0x27, 16, 2);

const int trigPin1 = 2, echoPin1 = 3;
const int trigPin2 = 4, echoPin2 = 5;
const int redLed1  = 6, blueLed1 = 7;
const int redLed2  = 8, blueLed2 = 9;

const int threshold = 15; // Set to 15cm

void setup() {
  Serial.begin(9600); // This opens the Serial Monitor for testing
  lcd.init();
  lcd.backlight();
  
  pinMode(trigPin1, OUTPUT); pinMode(echoPin1, INPUT);
  pinMode(trigPin2, OUTPUT); pinMode(echoPin2, INPUT);
  pinMode(redLed1, OUTPUT);  pinMode(blueLed1, OUTPUT);
  pinMode(redLed2, OUTPUT);  pinMode(blueLed2, OUTPUT);
}

long getDistance(int trig, int echo) {
  digitalWrite(trig, LOW);
  delayMicroseconds(2);
  digitalWrite(trig, HIGH);
  delayMicroseconds(10);
  digitalWrite(trig, LOW);
  long duration = pulseIn(echo, HIGH, 30000); // 30ms timeout
  if (duration == 0) return 999; // If no pulse, return a large distance
  return duration * 0.034 / 2;
}

void loop() {
  long d1 = getDistance(trigPin1, echoPin1);
  delay(50); 
  long d2 = getDistance(trigPin2, echoPin2);

  int freeSpots = 0;
  if (d1 > threshold) freeSpots++;
  if (d2 > threshold) freeSpots++;

  // Serial Debugging - Open Tools > Serial Monitor to see this!
  Serial.print("Sensor 1: "); Serial.print(d1);
  Serial.print("cm | Sensor 2: "); Serial.print(d2);
  Serial.print("cm | Free: "); Serial.println(freeSpots);

  // LCD Line 1: Spot Status
  lcd.setCursor(0, 0);
  lcd.print(d1 < threshold ? "S1:OCC " : "S1:FREE");
  lcd.print(" ");
  lcd.print(d2 < threshold ? "S2:OCC " : "S2:FREE");

  // LCD Line 2: Total Counter
  lcd.setCursor(0, 1);
  lcd.print("Available: ");
  lcd.print(freeSpots);
  lcd.print("   "); // Clear trailing numbers

  // LED Logic
  digitalWrite(redLed1, d1 < threshold ? HIGH : LOW);
  digitalWrite(blueLed1, d1 < threshold ? LOW : HIGH);
  digitalWrite(redLed2, d2 < threshold ? HIGH : LOW);
  digitalWrite(blueLed2, d2 < threshold ? LOW : HIGH);

  delay(300);
}